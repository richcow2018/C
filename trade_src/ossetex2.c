/************************************************************************************************/
/*                                                                                              */
/*  １．ソースファイル名                                                                        */
/*      ossetex2.c                                                                              */
/*                                                                                              */
/*                                                                                              */
/*  ２．プログラム名称                                                                          */
/*      例外ハンドラ設定                                                                        */
/*                                                                                              */
/*                                                                                              */
/*  ３．機能概要                                                                                */
/*      自プロセス管理テーブル個別部内のシグナルハンドラ管理域に、（第２引数）引数で指定された  */
/*      例外ハンドラのアドレスを設定する。                                                      */
/*                                                                                              */
/*                                                                                              */
/*  ４．呼び出し形式                                                                            */
/*      long    ossetex2()                                                                      */
/*                                                                                              */
/*                                                                                              */
/*  ５．引数                                                                                    */
/*      int     sig                                                                             */
/*      long    (*fun)()                                                                        */
/*                                                                                              */
/*                                                                                              */
/*  ６．返却値                                                                                  */
/*      NORMAL      ：正常に例外ハンドラの設定ができた                                          */
/*      OSEEICLS    ：シグナルの値が不当である                                                  */
/*                                                                                              */
/*                                                                                              */
/*  ７．前提事項・特記事項                                                                      */
/*      なし                                                                                    */
/*                                                                                              */
/*                                                                                              */
/************************************************************************************************/


/************************************************************************************************/
/*  インクルードファイル                                                                        */
/************************************************************************************************/
/******************************** 標準ヘッダ・ファイル ******************************************/


/***************************** 利用者作成ヘッダ・ファイル ***************************************/
#include	"ossetex.h"
#include	"ossetex_ins.h"


long	ossetex2(sig, fun)
int		sig;										/* シグナル									*/
long	(*fun)();									/* 例外ハンドラ								*/
{
	/********************************************************************************************/
	/*  ワーク領域                                                                              */
	/********************************************************************************************/

	os_trcget2( D_MD_OSSETEX2, D_T_TRA_IN, 0 );
													/* 関数入口									*/
	DbgMsg01(DLv02, (OutPut, "\n***** %s:Start DbgSubFnc\n", "ossetex2"));

//	DbgMsg01(DLv04, (OutPut, "***** %s:sig = %d \n", "ossetex2", sig));
//	DbgMsg01(DLv04, (OutPut, "***** %s:fun = %08lx \n", "ossetex2", (long)fun));


	/********************************************************************************************/
	/*  初期処理                                                                                */
	/********************************************************************************************/
	/****************************************/
	/*  引数チェック						*/
	/****************************************/
													/* シグナルが 1(SIGHUP)未満、又は			*/
													/* シグナルが31(SIGSYS)を超過する場合		*/
	if ((SIGHUP > sig) || (SIGSYS < sig))
	{
		//DbgMsg01(DLv05, (OutPut, "***** %s:%s  %s \n", "ossetex2",
		//		"処理異常!!", "シグナルの値が不当である。"));
		os_trcget2( D_MD_OSSETEX2, D_T_ERR_PRA, 1, sig );


		return(OSEEICLS);							/* invalid class							*/
	}


    /********************************************************************************************/
    /*  メイン処理                                                                              */
    /********************************************************************************************/
	/****************************************/
	/*  例外ハンドラの登録					*/
	/****************************************/
	ptMyEPRC->func[(sig -1)] = fun;					/* 例外ハンドラのアドレスを設定				*/


    /********************************************************************************************/
    /*  終了処理                                                                                */
    /********************************************************************************************/
													/* 関数出口									*/
	DbgMsg01( DLv02, ( OutPut, "\n***** %s: End  DbgSubFnc\n", "ossetex2" ) );
	os_trcget2( D_MD_OSSETEX2, D_T_TRA_OUT, 1, NORMAL );

	return(NORMAL);									/* 正常終了									*/
}
/************************************************************************************************/
/*  End                                                                                         */
/************************************************************************************************/
