/************************************************************************************************/
/*                                                                                              */
/*  １．ソースファイル名                                                                        */
/*      osrstex2.c                                                                              */
/*                                                                                              */
/*                                                                                              */
/*  ２．プログラム名称                                                                          */
/*      例外ハンドラのリセット                                                                  */
/*                                                                                              */
/*                                                                                              */
/*  ３．機能概要                                                                                */
/*      自プロセス管理テーブル個別部内の（引数で指定された）シグナルハンドラ管理域の            */
/*      例外ハンドラのアドレスをリセットする。                                                  */
/*                                                                                              */
/*                                                                                              */
/*  ４．呼び出し形式                                                                            */
/*      long    osrstex2()                                                                      */
/*                                                                                              */
/*                                                                                              */
/*  ５．引数                                                                                    */
/*      int     sig                                                                             */
/*                                                                                              */
/*                                                                                              */
/*  ６．返却値                                                                                  */
/*      NORMAL      ：正常に例外ハンドラのリセットができた                                      */
/*      OSEEICLS    ：シグナルの値が不当である                                                  */
/*      OSEENEXS    ：例外ハンドラが設定されていない                                            */
/*                                                                                              */
/*                                                                                              */
/*  ７．前提事項・特記事項                                                                      */
/*      なし                                                                                    */
/*                                                                                              */
/*                                                                                              */
/************************************************************************************************/


/************************************************************************************************/
/*  インクルードファイル                                                                        */
/************************************************************************************************/
/******************************** 標準ヘッダ・ファイル ******************************************/


/***************************** 利用者作成ヘッダ・ファイル ***************************************/
#include	"osrstex.h"
#include	"osrstex_ins.h"


long	osrstex2(sig)
int		sig;										/* シグナル									*/
{
	/********************************************************************************************/
	/*  ワーク領域                                                                              */
	/********************************************************************************************/
	long	lEndCode;								/* 終了コード								*/
    struct sigaction	tAct;						/* シグナル用								*/

	os_trcget2( D_MD_OSRSTEX2, D_T_TRA_IN, 0 );
													/* 関数入口									*/
	DbgMsg01(DLv02, (OutPut, "\n***** %s:Start DbgSubFnc\n", "osrstex2"));

//	DbgMsg01(DLv04, (OutPut, "***** %s:sig = %d \n", "osrstex2", sig));


	/********************************************************************************************/
	/*  初期処理                                                                                */
	/********************************************************************************************/
	/****************************************/
	/*  引数チェック						*/
	/****************************************/
													/* シグナルが 1(SIGHUP)未満、又は			*/
													/* シグナルが31(SIGSYS)を超過する場合		*/
	if ((SIGHUP > sig) || (SIGSYS < sig))
	{
//		DbgMsg01(DLv05, (OutPut, "***** %s:%s  %s \n", "osrstex2",
//				"処理異常!!", "シグナルの値が不当である。"));
		os_trcget2( D_MD_OSRSTEX2, D_T_ERR_PRA, 2, sig , OSEEICLS );

		return(OSEEICLS);							/* invalid class							*/
	}


    /********************************************************************************************/
    /*  メイン処理                                                                              */
    /********************************************************************************************/
	/****************************************/
	/*  例外ハンドラの登録					*/
	/****************************************/
													// 未登録時はエラー返却
	if( D_ADR_INI == ptMyEPRC->func[(sig -1)] )		// 20030228 追加
	{
		os_trcget2( D_MD_OSRSTEX2, D_T_ERR_PRA, 2, sig , OSEENEXS );
		return(OSEENEXS);
	}
	ptMyEPRC->func[(sig -1)] = D_ADR_INI;			/* 例外ハンドラのアドレスをリセット			*/


    /********************************************************************************************/
    /*  終了処理                                                                                */
    /********************************************************************************************/

													/* 関数出口									*/
	DbgMsg01( DLv02, ( OutPut, "\n***** %s: End  DbgSubFnc\n", "osrstex2" ) );
	os_trcget2( D_MD_OSRSTEX2, D_T_TRA_OUT, 1, NORMAL );
	return(NORMAL);									/* 正常終了									*/
}
/************************************************************************************************/
/*  End                                                                                         */
/************************************************************************************************/
